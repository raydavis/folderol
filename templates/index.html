<!DOCTYPE html>
<html>
  <head>
    <title>Django API</title>
    <style type="text/css" media="screen">
      body {
        margin: 0;
        margin-bottom: 25px;
        padding: 0;
        background-color: #f0f0f0;
        font-family: "Lucida Grande", "Bitstream Vera Sans", "Verdana";
        font-size: 13px;
        color: #333;
      }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" charset="utf-8">
	    $(function() {
		    function addUser(user) {
			    $('#users').append('<li>' + user.id + " : " + user.uid + ' : ' + user.preferred_name + '</ul>');
		    }
		    function addAllUsers() {
			    $('#users').empty();
			    $.getJSON('/api/user/', function(users) {
                    console.log(users)
				    $.each(users.objects, function() { addUser(this); });
			    });
		    }

		    $('#new_user').submit(function(e) {
                var param = {'uid': $('#new_user_uid').val()};
                console.log(JSON.stringify(param));
                $.ajax({
                    type: 'POST',
                    url: '/api/user/',
                    data: JSON.stringify(param),
                    success: addAllUsers,
                    contentType: 'application/json'
                });
			    this.reset();
			    e.preventDefault();
		    });

		    $('#me_prefs').submit(function(e) {
                var param = {'uid': $('#currentuser_uid').val(), 'preferred_name': $('#currentuser_preferred_name').val()};
			    $.ajax({
				   url: '/api/user/' + $("#currentuser_id").val() + '/',
				   type: 'PUT',
				   data: JSON.stringify(param),
				   success: addAllUsers(),
                   contentType: 'application/json'
			    });
			    this.reset();
			    e.preventDefault();
		    });

		    addAllUsers();
	    });
    </script>
  </head>
  <body>
  <div id="container">
	  <h1>Me</h1>
	  <form id="me_prefs">
		  <input type="text" name="user_id" id="currentuser_id">
		  <input type="text" name="uid" id="currentuser_uid">
		  <input type="text" name="preferred_name" id="currentuser_preferred_name">
		  <input type="submit" value="Update">
	  </form>
	  <h1>User List</h1>
	  <form id="new_user">
		  <input type="text" name="uid" id="new_user_uid">
		  <input type="submit" value="Add">
	  </form>
	  <ul id="users"></ul>
  </div>
  </body>
</html>
